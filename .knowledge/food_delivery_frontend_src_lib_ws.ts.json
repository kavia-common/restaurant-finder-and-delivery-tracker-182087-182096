{"is_source_file": true, "format": "TypeScript", "description": "This file implements a WebSocket client class for managing WebSocket connections, including subscription to events, reconnection logic, message handling, and utility functions for building the WebSocket URL with authentication tokens.", "external_files": ["./constants", "./auth"], "external_methods": ["getAuthToken"], "published": ["createWebSocketClient", "WebSocketClient"], "classes": [{"name": "WebSocketClient", "description": "A minimal publish/subscribe WebSocket client designed for receiving order updates or notifications, with built-in support for reconnection and event management."}], "methods": [{"name": "connect", "description": "Establishes the WebSocket connection, with automatic reconnection based on options."}, {"name": "disconnect", "description": "Closes the WebSocket connection and disables reconnection attempts."}, {"name": "send", "description": "Sends data over the WebSocket connection, supporting string, object, or array payloads."}, {"name": "on", "description": "Registers an event listener for WebSocket events ('open', 'message', 'error', 'close') and returns a function to remove the listener."}, {"name": "off", "description": "Removes a previously registered event listener."}, {"name": "export function createWebSocketClient(url?: string, options?: WSOptions): WebSocketClient { createWebSocketClient", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["getAuthToken", "new WebSocket", "JSON.parse", "setTimeout", "this.emit", "URL", "window.location.origin"], "search-terms": ["WebSocketClient", "reconnect", "auth token", "WSOptions", "pub/sub", "reconnection logic", "message handling"], "state": 2, "file_id": 32, "knowledge_revision": 90, "git_revision": "", "revision_history": [{"86": ""}, {"90": ""}], "ctags": [{"_type": "tag", "name": "Listener", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^type Listener = (data: MessageData) => void;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "MessageData", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^type MessageData = unknown;$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "WSOptions", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^type WSOptions = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "WebSocketClient", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^export class WebSocketClient {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "client", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  const client = new WebSocketClient(url, options);$/", "language": "TypeScript", "kind": "constant", "scope": "createWebSocketClient", "scopeKind": "function"}, {"_type": "tag", "name": "createWebSocketClient", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^export function createWebSocketClient(url?: string, options?: WSOptions): WebSocketClient {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "data", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^        let data: MessageData;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "envUrl", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^    const envUrl = ENV.WS_URL;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "listeners", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  private listeners = new Map<string, Set<Listener>>();$/", "language": "TypeScript", "kind": "property", "scope": "WebSocketClient", "scopeKind": "class"}, {"_type": "tag", "name": "options", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  private options: Required<WSOptions>;$/", "language": "TypeScript", "kind": "property", "scope": "WebSocketClient", "scopeKind": "class"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^      const payload =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "retries", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  private retries = 0;$/", "language": "TypeScript", "kind": "property", "scope": "WebSocketClient", "scopeKind": "class"}, {"_type": "tag", "name": "sep", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^      const sep = url.includes('?') ? '&' : '?';$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^    const token = getAuthToken();$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "u", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^      const u = new URL(url, typeof window !== 'undefined' ? window.location.origin : undefined)/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "url", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  private url: string;$/", "language": "TypeScript", "kind": "property", "scope": "WebSocketClient", "scopeKind": "class"}, {"_type": "tag", "name": "urlWithAuth", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^    const urlWithAuth = token ? this.addQueryParam(this.url, 'token', token) : this.url;$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "ws", "path": "/home/kavia/workspace/code-generation/restaurant-finder-and-delivery-tracker-182087-182096/food_delivery_frontend/src/lib/ws.ts", "pattern": "/^  private ws: WebSocket | null = null;$/", "language": "TypeScript", "kind": "property", "scope": "WebSocketClient", "scopeKind": "class"}], "hash": "1604ccff7ab31afa229c3b4987c65f4c", "format-version": 4, "code-base-name": "food_delivery_frontend", "filename": "food_delivery_frontend/src/lib/ws.ts", "fields": [{"name": "let data: MessageData;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private listeners = new Map<string, Set<Listener>>();", "scope": "WebSocketClient", "scopeKind": "class", "description": "unavailable"}, {"name": "private options: Required<WSOptions>;", "scope": "WebSocketClient", "scopeKind": "class", "description": "unavailable"}, {"name": "private retries = 0;", "scope": "WebSocketClient", "scopeKind": "class", "description": "unavailable"}, {"name": "private url: string;", "scope": "WebSocketClient", "scopeKind": "class", "description": "unavailable"}, {"name": "private ws: WebSocket | null = null;", "scope": "WebSocketClient", "scopeKind": "class", "description": "unavailable"}]}